# MVP实施计划 - 分阶段迭代

> **文档版本**: v1.0  
> **创建日期**: 2026-01-29  
> **目标**: 从最小MVP开始，逐步迭代到完整功能

---

## 📋 目录

1. [MVP定义](#1-mvp定义)
2. [阶段划分](#2-阶段划分)
3. [详细实施计划](#3-详细实施计划)
4. [技术债务管理](#4-技术债务管理)
5. [验收标准](#5-验收标准)

---

## 1. MVP定义

### 1.1 最小可行产品（MVP）目标

**核心价值**: 用户可以通过飞书机器人快速记账，并能查看基本的消费统计

**MVP功能范围**:
- ✅ 用户通过飞书机器人发送记账消息
- ✅ AI自动解析消息，生成交易流水
- ✅ 用户确认/修改/删除流水
- ✅ 查看本月消费总额（简单查询）
- ✅ 基础分类管理（预设分类）

**MVP不包含**:
- ❌ Web管理界面
- ❌ 定时任务
- ❌ 报表分析
- ❌ 订阅管理
- ❌ 预付摊销

### 1.2 MVP成功标准

1. **功能完整性**: 用户能完成完整的记账流程
2. **可用性**: AI识别准确率 > 70%
3. **稳定性**: 系统可用性 > 95%
4. **响应速度**: 消息处理时间 < 5秒

---

## 2. 阶段划分

```
MVP (Phase 0) → V1.0 (Phase 1) → V1.5 (Phase 2) → V2.0 (Phase 3) → V2.5 (Phase 4)
  2周             3周               4周               3周               2周
```

---

## 3. 详细实施计划

### 🎯 Phase 0: MVP - 最小可行产品 (2周)

**目标**: 实现核心记账功能，验证产品可行性

#### Week 1: 基础架构 + 核心功能

**Day 1-2: 项目初始化**
- [ ] 扩展 Prisma Schema（仅核心表：Transaction, Category）
- [ ] 创建基础 Repository 层
  - [ ] `transaction.repository.ts` (create, findById, findByDateRange)
  - [ ] `category.repository.ts` (findAll, findByLevel)
- [ ] 创建基础 Service 层
  - [ ] `transaction.service.ts` (createTransaction, getMonthlySummary)
  - [ ] `category.service.ts` (listCategories)

**Day 3-4: AI记账功能**
- [ ] 增强 `feishu-chat.service.ts`
  - [ ] 集成 transaction.service
  - [ ] 实现自然语言解析（简单场景："瑞幸 35"）
  - [ ] 实现AI生成交易流水
- [ ] 优化AI提示词（针对记账场景）
- [ ] 实现用户确认流程
  - [ ] 发送确认卡片消息
  - [ ] 处理用户确认/修改/删除操作

**Day 5: 查询功能**
- [ ] 实现简单查询（"这个月花了多少钱"）
- [ ] 实现分类查询（"餐饮花了多少"）
- [ ] 测试和修复

#### Week 2: 完善 + 测试

**Day 6-7: 分类管理**
- [ ] 创建预设分类数据（种子脚本）
- [ ] 实现分类查询和推荐
- [ ] 优化AI分类识别准确率

**Day 8-9: 错误处理和优化**
- [ ] 完善错误处理
- [ ] 添加日志记录
- [ ] 性能优化（数据库查询优化）
- [ ] AI识别准确率优化

**Day 10: MVP验收**
- [ ] 端到端测试
- [ ] 修复关键bug
- [ ] 准备演示

**MVP交付物**:
- ✅ 飞书机器人记账功能
- ✅ 基础分类管理
- ✅ 简单查询功能
- ✅ 用户确认流程

---

### 🚀 Phase 1: V1.0 - 核心功能完善 (3周)

**目标**: 完善记账功能，增加图片记账和批量记账

#### Week 1: 图片记账

**任务清单**:
- [ ] 完善 `vision.service.ts`（OCR识别）
- [ ] 实现图片记账流程
  - [ ] 接收图片消息
  - [ ] OCR识别小票
  - [ ] AI解析识别结果
  - [ ] 生成交易流水
- [ ] 测试和优化

#### Week 2: 批量记账 + 查询增强

**任务清单**:
- [ ] 实现批量记账（"今天花了：咖啡35，午餐50，打车20"）
- [ ] 增强查询功能
  - [ ] 日期范围查询
  - [ ] 分类统计查询
  - [ ] Top N 消费查询
- [ ] 实现交易修改功能

#### Week 3: 数据管理

**任务清单**:
- [ ] 实现交易删除功能
- [ ] 实现交易修改功能
- [ ] 添加交易备注功能
- [ ] 完善错误处理和用户提示

**V1.0交付物**:
- ✅ 图片记账功能
- ✅ 批量记账功能
- ✅ 增强的查询功能
- ✅ 完整的CRUD操作

---

### 📊 Phase 2: V1.5 - 报表和Web界面 (4周)

**目标**: 添加Web管理界面和基础报表功能

#### Week 1: Web基础架构

**任务清单**:
- [ ] 初始化 shadcn/ui
- [ ] 创建基础布局组件
- [ ] 实现路由保护（AuthGuard）
- [ ] 创建导航组件
- [ ] 实现仪表盘页面（基础数据展示）

#### Week 2: 核心管理页面

**任务清单**:
- [ ] 分类管理页面
  - [ ] 分类列表
  - [ ] 创建/编辑/删除分类
- [ ] 交易列表页面
  - [ ] 交易列表展示
  - [ ] 筛选和搜索
  - [ ] 分页功能
- [ ] 记账复核页面
  - [ ] 待确认流水列表
  - [ ] 批量确认功能

#### Week 3: 报表功能

**任务清单**:
- [ ] 创建报表服务（report.service.ts）
- [ ] 月度报表页面
  - [ ] 收入/支出统计
  - [ ] 分类支出图表
  - [ ] Top分类展示
- [ ] 周度报表页面
- [ ] 自定义报表页面（时间范围选择）

#### Week 4: 优化和测试

**任务清单**:
- [ ] UI/UX优化
- [ ] 响应式设计（移动端适配）
- [ ] 性能优化
- [ ] 测试和修复

**V1.5交付物**:
- ✅ Web管理界面
- ✅ 分类管理功能
- ✅ 交易管理功能
- ✅ 基础报表功能

---

### ⏰ Phase 3: V2.0 - 定时任务和AI分析 (3周)

**目标**: 实现定时任务系统和AI分析报告

#### Week 1: 定时任务基础

**任务清单**:
- [ ] 扩展 Prisma Schema（ScheduledTask, TaskExecutionLog）
- [ ] 安装和配置 BullMQ + Redis
- [ ] 创建任务调度器（task-scheduler.ts）
- [ ] 实现任务管理API（CRUD）
- [ ] 创建任务管理页面

#### Week 2: 报告生成和执行器

**任务清单**:
- [ ] 创建报告执行器
  - [ ] `daily-report.executor.ts`
  - [ ] `weekly-report.executor.ts`
  - [ ] `monthly-report.executor.ts`
- [ ] 实现AI分析服务（ai-analysis.service.ts）
- [ ] 集成报告生成和AI分析
- [ ] 实现飞书消息推送

#### Week 3: 完善和优化

**任务清单**:
- [ ] 任务执行日志
- [ ] 错误处理和重试机制
- [ ] 任务状态监控
- [ ] 测试和优化

**V2.0交付物**:
- ✅ 定时任务系统
- ✅ 自动报告推送
- ✅ AI分析报告
- ✅ 任务管理功能

---

### 💰 Phase 4: V2.5 - 订阅和预付管理 (2周)

**目标**: 实现订阅管理和预付摊销功能

#### Week 1: 订阅管理

**任务清单**:
- [ ] 创建订阅Repository和Service
- [ ] 实现订阅管理API
- [ ] 创建订阅管理页面
  - [ ] 订阅列表
  - [ ] 创建/编辑订阅
  - [ ] 订阅分析（使用频率）
- [ ] 实现订阅自动扣款（生成交易）

#### Week 2: 预付摊销

**任务清单**:
- [ ] 创建预付Repository和Service
- [ ] 实现预付管理API
- [ ] 创建分摊管理页面
  - [ ] 预付列表
  - [ ] 摊销进度展示
  - [ ] 手动触发摊销
- [ ] 实现自动摊销逻辑

**V2.5交付物**:
- ✅ 订阅管理功能
- ✅ 预付摊销功能
- ✅ 完整的财务管理功能

---

## 4. 技术债务管理

### 4.1 MVP阶段的技术债务

**可接受的技术债务**:
- ✅ 直接使用 Prisma Client（不引入Repository层）
- ✅ 简单的错误处理（不引入全局异常处理）
- ✅ 基础日志（console.log）
- ✅ 简单的AI提示词（不优化）

**必须避免的技术债务**:
- ❌ 硬编码配置
- ❌ 缺少数据校验
- ❌ 缺少基础错误处理

### 4.2 技术债务偿还计划

**Phase 1 偿还**:
- [ ] 引入Repository层
- [ ] 完善错误处理
- [ ] 添加输入校验（Zod）

**Phase 2 偿还**:
- [ ] 引入日志系统（Winston/Pino）
- [ ] 优化AI提示词
- [ ] 添加单元测试

---

## 5. 验收标准

### 5.1 MVP验收标准

**功能验收**:
- [ ] 用户可以通过飞书机器人发送记账消息
- [ ] AI能正确解析消息（准确率 > 70%）
- [ ] 用户可以确认/修改/删除流水
- [ ] 用户可以查询本月消费总额
- [ ] 系统稳定运行，无严重bug

**性能验收**:
- [ ] 消息处理时间 < 5秒
- [ ] 系统可用性 > 95%
- [ ] 数据库查询响应 < 500ms

**用户体验验收**:
- [ ] 交互流程顺畅
- [ ] 错误提示清晰
- [ ] 界面友好（飞书消息卡片）

### 5.2 各阶段验收标准

**Phase 1 (V1.0)**:
- [ ] 图片记账功能可用
- [ ] 批量记账功能可用
- [ ] 查询功能完善
- [ ] AI识别准确率 > 80%

**Phase 2 (V1.5)**:
- [ ] Web界面功能完整
- [ ] 报表数据准确
- [ ] 响应式设计完善
- [ ] 页面加载时间 < 2秒

**Phase 3 (V2.0)**:
- [ ] 定时任务正常执行
- [ ] 报告推送成功
- [ ] AI分析报告质量良好
- [ ] 任务管理功能完整

**Phase 4 (V2.5)**:
- [ ] 订阅管理功能完整
- [ ] 预付摊销功能正常
- [ ] 自动扣款功能正常

---

## 6. 风险控制

### 6.1 技术风险

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| AI识别准确率低 | 高 | MVP阶段降低期望，持续优化提示词 |
| 数据库性能瓶颈 | 中 | MVP阶段数据量小，后续优化 |
| 飞书API限流 | 低 | 实现请求队列，控制频率 |

### 6.2 进度风险

| 风险 | 影响 | 缓解措施 |
|------|------|---------|
| 开发进度延迟 | 中 | 每个阶段预留缓冲时间 |
| 需求变更 | 中 | 严格按阶段执行，避免范围蔓延 |
| 技术难点 | 高 | 提前技术预研，准备备选方案 |

---

## 7. 开发规范

### 7.1 代码规范

- **TypeScript**: 严格模式，禁止any
- **Git提交**: 使用conventional commits
- **代码审查**: 每个PR必须经过审查

### 7.2 分支策略

```
main (生产环境)
  ↑
develop (开发环境)
  ↑
feature/xxx (功能分支)
```

### 7.3 发布流程

1. 功能开发完成 → 合并到develop
2. 测试通过 → 合并到main
3. 部署到生产环境

---

## 8. 里程碑时间表

| 阶段 | 开始时间 | 结束时间 | 持续时间 | 关键交付物 |
|------|---------|---------|---------|-----------|
| **MVP** | Week 1 | Week 2 | 2周 | 飞书机器人记账 |
| **V1.0** | Week 3 | Week 5 | 3周 | 图片记账、批量记账 |
| **V1.5** | Week 6 | Week 9 | 4周 | Web界面、报表 |
| **V2.0** | Week 10 | Week 12 | 3周 | 定时任务、AI分析 |
| **V2.5** | Week 13 | Week 14 | 2周 | 订阅管理、预付摊销 |

**总计**: 14周（约3.5个月）

---

## 9. 快速开始指南

### MVP阶段第一天任务清单

**上午 (4小时)**:
1. [ ] 扩展 Prisma Schema
   ```prisma
   // 确保有 Transaction 和 Category 表
   // 如果已有，检查字段是否完整
   ```
2. [ ] 生成 Prisma Client
   ```bash
   pnpm db:generate
   pnpm db:push
   ```
3. [ ] 创建种子脚本（预设分类）
   ```bash
   # 创建 scripts/seed-categories.ts
   ```

**下午 (4小时)**:
4. [ ] 创建基础Repository
   ```typescript
   // lib/repositories/transaction.repository.ts
   // lib/repositories/category.repository.ts
   ```
5. [ ] 创建基础Service
   ```typescript
   // lib/services/transaction.service.ts
   // lib/services/category.service.ts
   ```
6. [ ] 测试Repository和Service
   ```bash
   # 创建简单的测试脚本
   ```

### MVP阶段第二天任务清单

**上午 (4小时)**:
1. [ ] 增强 feishu-chat.service.ts
   - [ ] 集成 transaction.service
   - [ ] 实现消息解析逻辑
2. [ ] 优化AI提示词
   - [ ] 创建记账专用提示词模板
   - [ ] 测试AI识别准确率

**下午 (4小时)**:
3. [ ] 实现用户确认流程
   - [ ] 发送确认卡片消息
   - [ ] 处理用户操作（确认/修改/删除）
4. [ ] 端到端测试
   - [ ] 测试完整流程
   - [ ] 修复发现的问题

---

## 10. 成功指标

### MVP阶段成功指标

- **功能指标**:
  - AI识别准确率 > 70%
  - 用户确认率 > 80%
  - 系统可用性 > 95%

- **性能指标**:
  - 消息处理时间 < 5秒
  - 数据库查询 < 500ms

- **用户指标**:
  - 至少10个测试用户
  - 用户满意度 > 7/10

### 后续阶段成功指标

- **V1.0**: AI识别准确率 > 80%，图片识别成功率 > 70%
- **V1.5**: Web页面访问量，用户活跃度
- **V2.0**: 定时任务执行成功率 > 95%
- **V2.5**: 订阅管理使用率，预付摊销准确率

---

## 11. 总结

### MVP核心原则

1. **最小功能集**: 只实现核心记账功能
2. **快速验证**: 2周内完成MVP，验证产品可行性
3. **技术债务可控**: 接受合理的技术债务，但避免严重问题
4. **持续迭代**: MVP完成后立即进入下一阶段

### 关键成功因素

- ✅ **聚焦核心功能**: 不要过早添加非核心功能
- ✅ **快速反馈**: 每个阶段完成后立即收集用户反馈
- ✅ **技术选型稳定**: 使用成熟技术，避免技术风险
- ✅ **团队协作**: 明确分工，定期同步进度

---

**文档维护**: 本文档应随开发进度持续更新，记录实际执行情况和调整。
